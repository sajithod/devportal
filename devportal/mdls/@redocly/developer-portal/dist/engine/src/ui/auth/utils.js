import*as React from"react";import{addTrailingSlash,usePathPrefix}from"../utils";export const REDOCLY_COOKIE_NAME="redocly_jwt";export const IDP_ACCESS_TOKEN_COOKIE_NAME="redocly_idp_access_token";export const IDP_ID_TOKEN_COOKIE_NAME="redocly_idp_id_token";export const REDOCLY_LOGIN_RESULT_COOKIE_NAME="redocly_login_result";export function getCookie(a){if("undefined"==typeof document)return"";const b=a+"=",d=decodeURIComponent(document.cookie),e=d.split(";");for(let c=0;c<e.length;c++){for(var f=e[c];" "===f.charAt(0);)f=f.substring(1);if(0===f.indexOf(b))return f.substring(b.length,f.length)}return""}export function deleteCookie(a,b){document.cookie=a+"=; "+(b?"path="+b+"; ":"")+"Max-Age=0"}export function logout(a,b=!0){const c=usePathPrefix();deleteCookie(REDOCLY_COOKIE_NAME),deleteCookie(REDOCLY_COOKIE_NAME,c||"/"),deleteCookie(IDP_ACCESS_TOKEN_COOKIE_NAME),deleteCookie(IDP_ACCESS_TOKEN_COOKIE_NAME,c||"/"),deleteCookie(IDP_ID_TOKEN_COOKIE_NAME),deleteCookie(IDP_ID_TOKEN_COOKIE_NAME,c||"/"),deleteCookie("id_token"),deleteCookie("access_token"),deleteCookie("token_type"),deleteCookie("expires_in");b&&setTimeout(()=>{if("undefined"!=typeof window){if(a)return void(window.location.href=a);window.location.href=c?addTrailingSlash(c):`/`}},20)}export function useProxiedFetch(a){return(b,c)=>{const d=new URL(b.replace(/^\//,""),`https://api.redoc.ly/proxy/${a}/`).href;return fetch(d,{...c,headers:{...c?.headers,Authorization:getUserJwt()}})}}export function getUserJwt(){return getCookie(REDOCLY_COOKIE_NAME)||getCookie("id_token")}export function useIsLoggedIn(){const[a,b]=React.useState(!1);return React.useEffect(()=>{b(!!getUserJwt())},[]),a}export function useIsAuthenticated(){const[a,b]=React.useState(!1),[c,d]=React.useState(!0);return React.useEffect(()=>{b(!!getUserJwt()),d(!1)},[]),{loading:c,isAuthenticated:a}}export function useUserClaims(){const[a,b]=React.useState(null),[c,d]=React.useState(!0);return React.useEffect(()=>{b(getUserClaims()),d(!1)},[]),{loading:c,claims:a}}export function getIdPJwt(){return getCookie(IDP_ID_TOKEN_COOKIE_NAME)??null}export function getIdPAccessToken(){return getCookie(IDP_ACCESS_TOKEN_COOKIE_NAME)??null}export function getUserId(){return getUserClaims()?.sub??null}export function getUserClaims(){const a=getUserJwt();if(!a)return null;let b=parseClaims(a);return b?b:null}export function parseClaims(a){if(!a)return null;const b=a.split(".")[1];if(!b)return null;let c=null;try{c=JSON.parse(atob(sanitizeBase64(b)))}catch(a){return c}return c}export function sanitizeBase64(a){return a.replace(/-/g,"+").replace(/_/g,"/")}