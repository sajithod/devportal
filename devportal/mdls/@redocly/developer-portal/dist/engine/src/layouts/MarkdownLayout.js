import{format}from"timeago.js";import*as React from"react";import{ProStore}from"@redocly/reference-docs";import{withTheme,ThemeContext}from"../styled-components";import{StyledContent}from"../components/StyledContent/StyledContent";import TableOfContent from"../components/TableOfContent/TableOfContent";import UserMarkdownLayout from"../components/UserComponents/layouts/Markdown";import{sanitizeDefinitionId}from"../../utils/utils";import{getHooks}from"../templates/get-hooks";import StepByStepWrapper from"../components/mdx/StepByStepWrapper";const LS_SNIPPETS_LANG="redocly_snippetsLang",CACHED_STORES={};export const RedocStoresContext=React.createContext({});function getStoreStateById(a,b){const c=(a["__oasDef_"+sanitizeDefinitionId(b)]||{}).redocStoreStr,d=c&&JSON.parse(c)||void 0;return d}function constructStoreFromPageData(a,b,c){let d=CACHED_STORES[c];if(!d){const e=getStoreStateById(a,c),f=getHooks();if(!e)return null;e.options=e.options||{},e.options.disableSearch=!0,e.options.ctrlFHijack=!1,e.options.showNextButton=!1,e.options.disableSidebar=!0,e.options.disableDeepLinks=!0,e.options.theme=b,e.options.showConsole=e.options.showConsole||!0,e.options.hooks=f,d=ProStore.fromJS(e),CACHED_STORES[c]=d}return d}class GetStoreInner extends React.Component{render(){return React.createElement(RedocStoresContext.Consumer,null,a=>{const b=constructStoreFromPageData(a,this.props.theme,this.props.definitionId);return b?this.props.children(b):React.createElement("pre",{style:{color:"red"}},"Incorrect definitionId: \"",this.props.definitionId,"\"")})}}export const GetStore=withTheme(GetStoreInner);export function useOasDefinitionStore(a){const b=React.useContext(ThemeContext),c=React.useContext(RedocStoresContext);return constructStoreFromPageData(c,b,a)}export function useOasDefinition(a){const b=React.useContext(RedocStoresContext);return getStoreStateById(b,a)?.definition?.data||null}export default function MarkdownLayout(a){const[b,c]=React.useState(null),d=React.useCallback(a=>{c(a)},[]);React.useEffect(()=>{if(!b)return()=>void 0;if(b?.addEventListener("click",onSnippetTabClick),a.location.hash)switchSnippetsLang(a.location.hash.substring(1));else{const a=window.localStorage&&window.localStorage.getItem(LS_SNIPPETS_LANG);a&&switchSnippetsLang(a)}return()=>b?.removeEventListener("click",onSnippetTabClick)},[b]);const{html:e,data:f,location:g,pageContext:h}=a,i=f.contentItem&&f.contentItem.data.lastModified,j=isTocEnabled(h),k=h.toc&&h.toc.headings,l={};for(let b in f)b.startsWith("__oasDef_")&&(l[b]=f[b]);const m=null==e?React.createElement(StyledContent,{ref:d},a.children):React.createElement(StyledContent,{ref:d,dangerouslySetInnerHTML:{__html:e||""}}),n=h.data||{},o=h.pageId||"";return React.createElement(RedocStoresContext.Provider,{value:l},React.createElement(StepByStepWrapper,null,React.createElement(UserMarkdownLayout,{location:g,headings:k,contentWrapper:b,Toc:()=>j?React.createElement(TableOfContent,{headings:k,tocMaxDepth:h?.toc?.maxDepth,contentWrapper:b}):null,withToc:j,lastModified:!disableLastModified(f)&&i||void 0,lastModifiedAgo:i&&!disableLastModified(f)?format(i):void 0,frontmatter:n,pageId:o},m)))}function onSnippetTabClick(a){if(a.target.classList.contains("tab-header")&&a.target.parentElement.classList.contains("snippets-tabs-headers")){const b=a.target.dataset.snippetId||a.target.dataset.lang;history.pushState(null,"","#"+b),switchSnippetsLang(b)}}function switchSnippetsLang(a){function b(a,b){if(a)for(const c of a)c.dataset.snippetId===b?c.classList.add("active"):c.classList.remove("active")}const c=document.querySelectorAll(`[data-snippet-id="${a}"]`);window.localStorage&&window.localStorage.setItem(LS_SNIPPETS_LANG,a);for(const d of c)b(d.parentElement?.children,a)}export function isTocEnabled(a){if(!a)return!1;const b=a.toc&&a.toc.headings,c=b&&b.some(a=>4>=a.depth),d=1===b?.length&&1===b[0]?.depth;return c&&!d&&(a.toc&&a.toc.enable||!1)}export function disableLastModified(a){if(!a)return!1;const b=a.contentItem&&a.contentItem.data.disableLastModified,c=a.siteConfig&&a.siteConfig.disableLastModified;return!1!==b&&(b||c)}