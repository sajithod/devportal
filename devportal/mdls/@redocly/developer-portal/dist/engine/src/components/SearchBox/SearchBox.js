import{navigate}from"gatsby";import*as React from"react";import{SearchWrap}from"./searchbox.elements";import UserSearchInput from"../UserComponents/SearchInput";import UserSearchResults from"../UserComponents/SearchResults";import{SearchService}from"../../services/SearchIndex";export class SearchBox extends React.Component{constructor(a){super(a),this.querySearchResults=debounce(async a=>{if(!a)return void this.setState({loading:!1,results:[]});this.setState({loading:!0});try{const b=await this._searchIndex.search(a);if(this.state.query!==a)return;Array.isArray(b)?this.setState({results:b}):b.message&&this.setState({indexError:!0})}finally{this.state.query===a&&this.setState({loading:!1})}},250,!0),this.onSearch=async a=>{const b=a.target.value;this.setState({query:b}),this.querySearchResults(b)},this.onClearIconClick=()=>{this.setState({query:"",results:[]})},this.onToggleSearchResults=a=>{this.setState({showSearchResults:a})},this.handleKeyDown=a=>{if(27===a.keyCode&&(this.onClearIconClick(),a.target.blur()),40===a.keyCode&&(this.setState({activeItemIdx:Math.min(this.state.activeItemIdx+1,this.state.results.length-1)}),a.preventDefault()),38===a.keyCode&&(this.setState({activeItemIdx:Math.max(0,this.state.activeItemIdx-1)}),a.preventDefault()),13===a.keyCode){const a=this.state.results[this.state.activeItemIdx];a&&navigate(a.link)}};this.state={isSearchShown:!1,showSearchResults:!1,isSearchBoxShown:!1,query:"",results:[],indexError:!1,loading:!1,activeItemIdx:-1}}componentDidMount(){this._searchIndex=new SearchService,this._searchIndex.init(process.env.REDOCLY_PREFIX_PATHS,process.env.REDOCLY_PREFIX_ASSETS)}render(){const{className:a}=this.props,{showSearchResults:b,results:c,loading:d,query:e,indexError:f,activeItemIdx:g}=this.state;return React.createElement(SearchWrap,{className:a},React.createElement(UserSearchInput,{onChange:this.onSearch,onToggleSearchResults:this.onToggleSearchResults,onKeyDown:this.handleKeyDown,onClear:this.onClearIconClick,query:e||"",loading:d,location:this.props.location}),React.createElement(UserSearchResults,{show:b,results:c,indexError:f,query:e,loading:d,activeItemIdx:g,location:this.props.location}))}}export function debounce(a,b,c){let d,e=0;return function(...f){function g(){1<e&&a(...f),e=0,d=null}e++,d?clearTimeout(d):c&&a(...f),d=setTimeout(g,b)}}