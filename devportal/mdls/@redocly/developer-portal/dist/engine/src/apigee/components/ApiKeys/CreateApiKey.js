import*as React from"react";import{H3,Flex,Alert}from"../../../ui";import Dialog from"../common-elements/Dialog";import{StyledButton}from"../common-elements/styled.elements";import ApisList from"../ApisList";import{useParams}from"@reach/router";import{APIClientContext}from"../../services/APIClientProvider";import CircularProgress from"../common-elements/CircularProgress";import{useMutation,useQuery,useQueryClient}from"react-query";import{QUERY_KEY_APP,QUERY_KEY_PRODUCTS}from"../../services/config";export default function CreateApiKey(a){const{apiClient:b}=React.useContext(APIClientContext),c=useQueryClient(),{attributes:d}=a,[e,f]=React.useState([]),[g,h]=React.useState(!1),i=useParams(),j=useQuery(QUERY_KEY_PRODUCTS,()=>b?.getApiProducts()),{isLoading:k,error:l,mutateAsync:m}=useMutation(()=>b.createDeveloperAppKey(i.appName,e,d),{onSuccess:()=>{c.invalidateQueries(QUERY_KEY_APP)}}),n=()=>h(!0),o=()=>h(!1);return React.createElement(React.Fragment,null,React.createElement(StyledButton,{color:"primary",onClick:n},"Create API key"),React.createElement(Dialog,{open:g,onOpen:n,onClose:o},React.createElement(React.Fragment,null,React.createElement(H3,{mt:"0",mb:"1em"},"Create key"),j.isLoading?React.createElement(Flex,{justifyContent:"center"},React.createElement(CircularProgress,null)):j.error?React.createElement(Alert,{variant:"danger",content:j.error.message}):React.createElement(ApisList,{products:j?.data?.apiProduct,enabledApis:e,onChange:a=>{f(a)}}),l?React.createElement(Alert,{variant:"danger",content:l.message}):null,React.createElement(Flex,{mt:"2em",justifyContent:"flex-end"},React.createElement(StyledButton,{color:"secondary",onClick:o},"Cancel"),React.createElement(StyledButton,{color:"primary",onClick:async()=>{await m(),o()},disabled:k||1>e.length},k&&React.createElement(CircularProgress,{size:18}),"Create key")))))}