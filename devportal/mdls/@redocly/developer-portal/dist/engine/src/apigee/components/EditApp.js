import*as React from"react";import{Alert,H2,Flex}from"../../ui";import Dialog from"./common-elements/Dialog";import TextField from"./common-elements/TextField";import{SimpleButton,StyledButton}from"./common-elements/styled.elements";import{APIClientContext}from"../services/APIClientProvider";import CircularProgress from"./common-elements/CircularProgress";import{useMutation,useQueryClient}from"react-query";import{QUERY_KEY_APP}from"../services/config";export default function EditApp(a){const{apiClient:b}=React.useContext(APIClientContext),c=useQueryClient(),{appName:d,appDisplayName:e}=a,f=e||d||"",[g,h]=React.useState(f),[i,j]=React.useState(!1),k=async()=>{await n(),m()},l=()=>j(!0),m=()=>{j(!1),h(f)},{mutateAsync:n,isLoading:o,error:p}=useMutation(()=>b.renameDeveloperApp(d,g),{onMutate:async()=>{await c.cancelQueries(QUERY_KEY_APP);const a=c.getQueryData(QUERY_KEY_APP),b=a?.attributes?.find(a=>"DisplayName"===a.name);if(b)return b.value=g,c.setQueryData(QUERY_KEY_APP,a=>({...a})),a;const d=[...(a?.attributes||[]),{name:"DisplayName",value:g}];return c.setQueryData(QUERY_KEY_APP,a=>({...a,attributes:d})),a},onSettled:()=>{c.invalidateQueries(QUERY_KEY_APP)}}),q=/^(?!\s*$).{1,100}$/gi.test(g);return React.createElement(React.Fragment,null,React.createElement(SimpleButton,{onClick:l},"Edit"),React.createElement(Dialog,{open:i,onClose:m,onOpen:l},React.createElement(React.Fragment,null,React.createElement(H2,{mt:"0"},"Change display name"),React.createElement(TextField,{label:"Display name",inputProps:{value:g,onChange:a=>h(a.target.value),onKeyPress:a=>{"Enter"===a.key&&!o&&q&&k()}}}),p&&React.createElement(Alert,{variant:"danger",content:p.message}),React.createElement(Flex,{mt:"2em",justifyContent:"flex-end"},React.createElement(StyledButton,{onClick:m},"Cancel"),React.createElement(StyledButton,{color:"primary",onClick:k,disabled:o||!q},o&&React.createElement(CircularProgress,{size:18})," Save changes")))))}