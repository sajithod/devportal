const path=require("path"),{exists,ensureDir,writeFile}=require("fs-extra"),{REDOCLY_CONFIG_DIR}=require("../../../engine/constants"),getMetaRedirect=require("./getMetaRedirect");async function processingRedirects(a,b,c){const d={};for(const e of a){const{fromPath:a,toPath:f}=e,g=a.replace(c,""),h=path.join(b,g,"index.html");d[g]={to:f,type:301};const i=await exists(h);if(i)continue;if(process.env.SKIP_META_REDIRECT)continue;try{await ensureDir(path.dirname(h))}catch(a){}const j=getMetaRedirect(f);await writeFile(h,j)}const e=path.join(b,`${REDOCLY_CONFIG_DIR}/redirects.json`);await writeFile(e,JSON.stringify(d))}exports.onPostBuild=({store:a})=>{const{redirects:b,program:c,config:d}=a.getState();let e="";d.pathPrefix&&(e=d.pathPrefix);const f=path.join(c.directory,"public");return processingRedirects(b,f,e)};