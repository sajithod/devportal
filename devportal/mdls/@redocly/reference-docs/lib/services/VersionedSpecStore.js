"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VersionedSpecStore=void 0;var tslib_1=require("tslib"),redoc_lib_1=require("../redoc-lib"),mobx_1=require("mobx");function assignSpecIdxDeep(e,r,t){e.forEach((function(e){if(e.items&&assignSpecIdxDeep(e.items,r,t),e.id=t+"/"+e.id,"operation"===e.type){e.specIdx=r;for(var i=0,o=e.security;i<o.length;i++)for(var n=0,s=o[i].schemes;n<s.length;n++){var c=s[n];c.sectionId=t+"/"+c.sectionId}}}))}var VersionedSpecStore=function(){function e(e,r,t){if(Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"versions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"activeVersionIdx",{enumerable:!0,configurable:!0,writable:!0,value:-1}),(0,mobx_1.makeObservable)(this),this.versions=[],e.versions){for(var i=0,o=0,n=0,s=e.versions||[];n<s.length;n++){var c=s[n];c.isDefault&&(o=i);var a=new redoc_lib_1.SpecStore(c.spec,void 0,r);this.versions.push(a),assignSpecIdxDeep(a.contentItems,i,c.id);for(var u=0,b=a.securitySchemes.schemes;u<b.length;u++){var d=b[u];d.sectionId=c.id+"/"+d.sectionId}c.id===t&&(this.activeVersionIdx=i),i++,c._searchIndexName&&(a._searchIndexName=c._searchIndexName)}-1===this.activeVersionIdx&&(this.activeVersionIdx=o),e.versions[o].isDefault=!0}}return Object.defineProperty(e.prototype,"versionsInfo",{get:function(){return this.config.versions||[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentVersionId",{get:function(){return this.versionsInfo[this.activeVersionIdx]&&this.versionsInfo[this.activeVersionIdx].id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentItems",{get:function(){return this.versions[this.activeVersionIdx].contentItems},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"securitySchemes",{get:function(){return this.versions[this.activeVersionIdx].securitySchemes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"externalDocs",{get:function(){return this.versions[this.activeVersionIdx].externalDocs},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parser",{get:function(){return this.versions[this.activeVersionIdx].parser},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"info",{get:function(){return this.versions[this.activeVersionIdx].info},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"changeVersion",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.activeVersionIdx=e}}),Object.defineProperty(e.prototype,"toJS",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.config}}),(0,tslib_1.__decorate)([mobx_1.observable],e.prototype,"activeVersionIdx",void 0),(0,tslib_1.__decorate)([mobx_1.action],e.prototype,"changeVersion",null),e}();exports.VersionedSpecStore=VersionedSpecStore;
//# sourceMappingURL=VersionedSpecStore.js.map