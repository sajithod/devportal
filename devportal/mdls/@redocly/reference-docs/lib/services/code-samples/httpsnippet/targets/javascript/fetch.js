"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.info=void 0;var tslib_1=require("tslib"),code_builder_1=require("../../helpers/code-builder"),stringify_object_1=(0,tslib_1.__importDefault)(require("stringify-object")),code_helpers_1=require("../../helpers/code-helpers"),utils_1=require("../../../../utils"),__1=require("../.."),constants_1=require("../../helpers/constants"),handler=function(e,t,a){var r,i,n,s,o,l=a.target,d=a.client,p=(0,tslib_1.__assign)({indent:"  ",credentials:null},t),c=new code_builder_1.CodeBuilder({indentation:p.indent,variablesPrefix:p.variablesPrefix,capitalize:!0,lang:constants_1.Lang.JAVASCRIPT}),h={method:e.method.toUpperCase()};Object.keys(e.headersObj).length&&(h.headers=e.headersObj);var u=!1;if(p.withComments&&addComments(c),null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r.length){var _=new __1.HTTPSnippet(null===(i=e.securityOAuth2ExtraCalls)||void 0===i?void 0:i[0]).convert(l,d,(0,tslib_1.__assign)((0,tslib_1.__assign)({},p),{withImports:!1,withComments:!1,variablesPrefix:"oAuth2"}));c.push(_),c.blank(),h.headers=h.headers||{},h.headers.Authorization="'Bearer ' + oAuth2Data.access_token",u=!0}null!==p.credentials&&(h.credentials=p.credentials);var b=Object.getOwnPropertyNames(e.queryObj).length;if(b&&c.push("const "+c.var("query")+" = new URLSearchParams("+(0,stringify_object_1.default)(e.queryObj,{indent:p.indent,inlineCharacterLimit:25})+").toString();").blank(),e.postData)switch((0,utils_1.normalizeMimeType)(e.postData.mimeType)){case"application/x-www-form-urlencoded":h.body=e.postData.paramsObj?"new URLSearchParams("+c.var("formData")+").toString()":e.postData.text,e.postData.paramsObj&&c.push("const "+c.var("formData")+" = "+(0,code_helpers_1.addIndentation)((0,stringify_object_1.default)(e.postData.paramsObj,{indent:p.indent,inlineCharacterLimit:25}),{level:0,firstLine:!1})+";").blank();break;case"application/json":e.postData.jsonObj&&(h.body="JSON.stringify("+(0,code_helpers_1.addIndentation)((0,stringify_object_1.default)(e.postData.jsonObj,{indent:p.indent,inlineCharacterLimit:25}),{level:1,firstLine:!1})+")");break;case"multipart/form-data":c.push("const "+c.var("form")+" = new FormData();"),(null===(n=null==h?void 0:h.headers)||void 0===n?void 0:n["Content-Type"])&&(null===(s=h.headers)||void 0===s||delete s["Content-Type"]),e.postData.params.forEach((function(e){c.push(c.var("form")+".append(%s, %s);",JSON.stringify(e.name),JSON.stringify(e.value||e.fileName||""))})),h.body=c.var("form"),c.blank();break;default:e.postData.text&&(h.body="`"+(0,code_helpers_1.addIndentation)(e.postData.text,{level:2,indent:p.indent,firstLine:!1}).trim()+"`")}var m=h.headers&&h.headers.Accept&&"application/json"===(0,utils_1.normalizeMimeType)(h.headers.Accept)||"application/json"===(0,utils_1.normalizeMimeType)(null===(o=e.postData)||void 0===o?void 0:o.mimeType);if(e.basicAuth){var f=e.basicAuth,v=f.username,y=f.password;h.headers=h.headers||{},h.headers.Authorization="'Basic ' + btoa('"+v+":"+y+"')",u=!0}(0,code_helpers_1.printUrlVariablesDeclarations)(e,c);var g=(0,code_helpers_1.buildUrlExpression)(e,c);return c.push("const "+c.var("resp")+" = await fetch(").push(1,"`"+g+(b?"?${"+c.var("query")+"}":"")+"`,").push((0,code_helpers_1.addIndentation)((0,stringify_object_1.default)(h,{indent:p.indent,inlineCharacterLimit:25,transform:(0,code_helpers_1.getPreserveTransformer)({body:!0,authorizationHeader:u})}),{level:1,indent:p.indent})).push(");").blank().push("const "+c.var("data")+" = await "+c.var("resp")+"."+(m?"json()":"text()")+";").push("console.log("+c.var("data")+");"),c.join()};function addComments(e){e.push("/**"),e.push(" * Requires ES8-compatible browser: https://caniuse.com/async-functions"),e.push(" */"),e.blank()}exports.info={key:"fetch",title:"fetch",link:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch",description:"Perform asynchronous HTTP requests with the Fetch API"},exports.default=handler;
//# sourceMappingURL=fetch.js.map