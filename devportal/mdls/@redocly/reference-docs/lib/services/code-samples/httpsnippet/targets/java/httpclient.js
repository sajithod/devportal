"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.info=void 0;var tslib_1=require("tslib"),code_builder_1=require("../../helpers/code-builder"),__1=require("../.."),utils_1=require("../../../../utils"),code_helpers_1=require("../../helpers/code-helpers"),constants_1=require("../../helpers/constants"),URL_ENCODED="application/x-www-form-urlencoded",hasQueryParams=function(e){return!(!e.uriObj.query||!Object.keys(e.uriObj.query).length)},getBody=function(e){return e.postData&&e.postData.mimeType===URL_ENCODED?"HttpRequest.BodyPublishers.ofString(form)":e.postData?"HttpRequest.BodyPublishers.ofString(payload)":["POST","PUT","PATCH"].includes(e.method.toUpperCase())?'HttpRequest.BodyPublishers.ofString("some body text")':""},handler=function(e,t,a){var s,r,i,n=a.target,o=a.client,p=Object.assign({indent:"  ",withWrapper:!0},t),l=new code_builder_1.CodeBuilder({indentation:p.indent,variablesPrefix:p.variablesPrefix,capitalize:!0,lang:constants_1.Lang.JAVA}),u=!1;if(p.withComments&&addComments(l,e),p.withImports&&addImports(l,e),p.withWrapper&&(l.push("public class App {"),l.push(1,"public static void main(String[] args) throws Exception {"),l.push(2,"var httpClient = HttpClient.newBuilder().build();"),l.blank()),null===(s=e.securityOAuth2ExtraCalls)||void 0===s?void 0:s.length){var h=new __1.HTTPSnippet(null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0]).convert(n,o,(0,tslib_1.__assign)((0,tslib_1.__assign)({},p),{withImports:!1,withWrapper:!1,withComments:!1,variablesPrefix:"oauth2"}));l.push(h),l.blank(),l.push(2,"var oauth2Response = httpClient.send(oauth2Request, HttpResponse.BodyHandlers.ofString());"),l.push(2,'var accessToken = new JSONObject(oauth2Response.body()).getString("access_token");'),l.blank()}if(e.postData)switch((0,utils_1.normalizeMimeType)(e.postData.mimeType)){case URL_ENCODED:e.postData.params&&(l.push(2,"HashMap<String, String> params = new HashMap<>();"),e.postData.params.forEach((function(e){l.push(2,'params.put("%s", "%s");',e.name,e.value)})),l.blank(),l.push(2,"var form = params.keySet().stream()"),l.push(3,'.map(key -> key + "=" + URLEncoder.encode(params.get(key), StandardCharsets.UTF_8))'),l.push(3,'.collect(Collectors.joining("&"));'),l.blank());break;case"application/json":e.postData.jsonObj&&(l.push(2,'var payload = String.join("\\n"\n      '+(0,code_helpers_1.addIndentation)(JSON.stringify(e.postData.jsonObj,null,1).replace(/"/g,'\\"').replace(/^/gm,', "').replace(/$/gm,'"'),{level:3,indent:p.indent,firstLine:!1})),l.push(2,");"),l.blank());break;case"application/xml":e.postData.text&&(l.push(2,'var payload = String.join("\\n"'),e.postData.text.trim().split("\n").forEach((function(e){var t=e.replace(/"/g,'\\"');l.push(3,', "'+t+'"')})),l.push(2,");"),l.blank());break;case"multipart/form-data":u=!0,l.unshift("# multipart/form-data is not supported yet\n")}if(hasQueryParams(e)){l.push(2,"HashMap<String, String> params = new HashMap<>();");for(var d=0,c=Object.entries(e.uriObj.query);d<c.length;d++){var m=c[d],v=m[0],b=m[1];l.push(2,'params.put("%s", "%s");',v,b)}l.blank(),l.push(2,"var query = params.keySet().stream()"),l.push(3,'.map(key -> key + "=" + URLEncoder.encode(params.get(key), StandardCharsets.UTF_8))'),l.push(3,'.collect(Collectors.joining("&"));'),l.blank()}l.push(2,"var "+l.var("host")+' = "%s";',e.uriObj.protocol+"//"+e.uriObj.host),(0,code_helpers_1.printUrlVariablesDeclarations)(e,l,2);var g=(0,tslib_1.__assign)((0,tslib_1.__assign)({},e),{pathname:e.uriObj.pathname});l.push(2,"var "+l.var("pathname")+" = %s;",(0,code_helpers_1.buildUrlExpression)(g,l)),l.push(2,"var "+l.var("request")+" = HttpRequest.newBuilder()"),"PATCH"===e.method.toUpperCase()?l.push(3,'.method("PATCH", %s)',getBody(e)):l.push(3,".%s(%s)",e.method.toUpperCase(),getBody(e)),l.push(3,".uri(URI.create("+l.var("host")+" + "+l.var("pathname")+" %s))",hasQueryParams(e)?"+ '?' + query":""),(null===(i=e.securityOAuth2ExtraCalls)||void 0===i?void 0:i.length)&&(e.allHeaders.Authorization='"Bearer " + accessToken');var y=Object.keys(e.allHeaders);if(y.length&&y.forEach((function(t){var a;l.push(3,'.header("%s", %s)',t,"Authorization"===t&&(null===(a=e.securityOAuth2ExtraCalls)||void 0===a?void 0:a.length)?e.allHeaders[t]:'"'+e.allHeaders[t]+'"')})),e.basicAuth){var _=e.basicAuth,f=_.username,j=_.password;l.push(3,'.header("Authorization", "Basic " + Base64.getEncoder().encodeToString(("'+f+":"+j+'").getBytes()))')}return l.push(3,".build();"),p.withWrapper&&(l.blank(),l.push(2,"var response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());"),l.blank(),l.push(2,"System.out.println(response.body());"),l.push(1,"}"),l.push("}")),u&&l.clean(),l.join()};function addComments(e,t){var a;e.push("/**"),e.push(" * Requires JDK >= 11"),(null===(a=t.securityOAuth2ExtraCalls)||void 0===a?void 0:a.length)&&(e.push(" *"),e.push(' * Requires package "org.json" >= 20201115'),e.push(" * See here for installation details:"),e.push(" *  https://search.maven.org/artifact/org.json/json")),e.push(" */"),e.blank()}function addImports(e,t){var a,s,r,i;e.push("import java.net.*;"),e.push("import java.net.http.*;"),e.push("import java.util.*;"),((0,utils_1.normalizeMimeType)(null===(a=t.postData)||void 0===a?void 0:a.mimeType)===URL_ENCODED&&(null===(s=t.postData)||void 0===s?void 0:s.params)||(null===(r=t.securityOAuth2ExtraCalls)||void 0===r?void 0:r.length)||hasQueryParams(t))&&(e.push("import java.nio.charset.StandardCharsets;"),e.push("import java.util.stream.Collectors;")),(null===(i=t.securityOAuth2ExtraCalls)||void 0===i?void 0:i.length)&&e.push("import org.json.JSONObject;"),e.blank()}exports.info={key:"httpclient",title:"HttpClient",link:"https://docs.oracle.com/en/java/javase/11/docs/api/java.net.http/java/net/http/HttpClient.html",description:"HttpClient (Java SE 11 & JDK 11 )"},exports.default=handler;
//# sourceMappingURL=httpclient.js.map