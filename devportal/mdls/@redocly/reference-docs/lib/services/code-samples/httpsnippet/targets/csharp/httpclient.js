"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.info=void 0;var tslib_1=require("tslib"),stringify_object_1=(0,tslib_1.__importDefault)(require("stringify-object")),code_builder_1=require("../../helpers/code-builder"),__1=require("../.."),code_helpers_1=require("../../helpers/code-helpers"),utils_1=require("../../../../utils"),generator_1=require("../../../generator"),constants_1=require("../../helpers/constants"),handler=function(t,e,s){var a,n,i,r,o=s.target,p=s.client,u=Object.assign({indent:"  ",withWrapper:!0},e),l=new code_builder_1.CodeBuilder({indentation:u.indent,variablesPrefix:u.variablesPrefix,capitalize:!0,lang:constants_1.Lang.CSHARP}),c=formatHttpMethod(t.method);if(u.withComments&&addComments(l),u.withWrapper&&(l.push("using System;"),l.push("using System.Net.Http;"),l.push("using System.Threading.Tasks;"),(f("application/json")||f("application/xml")||t.basicAuth)&&l.push("using System.Text;"),(f("application/x-www-form-urlencoded")||(null===(a=t.securityOAuth2ExtraCalls)||void 0===a?void 0:a.length))&&l.push("using System.Collections.Generic;"),(f("application/json")||(null===(n=t.securityOAuth2ExtraCalls)||void 0===n?void 0:n.length))&&l.push("using Newtonsoft.Json.Linq;"),t.headersObj&&"application/octet-stream"===t.headersObj["Content-Type"]&&(l.push("using System.IO;"),l.push("using System.Net.Http.Headers;")),l.blank(),l.push("public class Program"),l.push("{"),l.push(1,"public static async Task Main(string[] args)"),l.push(1,"{"),l.push(2,"using (var client = new HttpClient())"),l.push(2,"{")),null===(i=t.securityOAuth2ExtraCalls)||void 0===i?void 0:i.length){var h=new __1.HTTPSnippet(null===(r=t.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0]).convert(o,p,(0,tslib_1.__assign)((0,tslib_1.__assign)({},u),{withImports:!1,withWrapper:!1,withComments:!1,variablesPrefix:"oauth2"}));l.push(h),l.push(3,"var oauth2Response = await oauth2Request.Content.ReadAsStringAsync();"),l.push(3,"JObject inputJObject = JObject.Parse(oauth2Response);"),l.push(3,'var accessToken = inputJObject["access_token"].ToString();'),l.blank()}var d=Object.keys(t.allHeaders).filter((function(t){switch(t.toLowerCase()){case"content-type":case"content-length":case"accept-encoding":return!1;default:return!0}}));if(d.length&&d.forEach((function(e){var s;l.push(3,'client.DefaultRequestHeaders.Add("%s", %s);',e,(null===(s=t.securityOAuth2ExtraCalls)||void 0===s?void 0:s.length)?'"Bearer " + accessToken':'"'+t.allHeaders[e]+'"')})),t.basicAuth){var m=t.basicAuth,g=m.username,b=m.password;l.push(3,'var base64String = Convert.ToBase64String(Encoding.ASCII.GetBytes("'+g+":"+b+'"));'),l.push(3,'client.DefaultRequestHeaders.Add("Authorization", "Basic "+ base64String);')}if(t.postData)switch((0,utils_1.normalizeMimeType)(t.postData.mimeType)){case"application/x-www-form-urlencoded":t.postData.params&&(l.blank(),l.push(3,"List<KeyValuePair<string, string>> postData = new List<KeyValuePair<string, string>>();"),t.postData.params.forEach((function(t){l.push(3,'postData.Add(new KeyValuePair<string, string>("%s", "%s"));',t.name,t.value)})),l.blank());break;case"multipart/form-data":t.postData.params&&(l.blank(),l.push(3,"MultipartFormDataContent postData = new MultipartFormDataContent();"),t.postData.params.forEach((function(t){l.push(3,'postData.Add(new StringContent("%s"), "%s");',t.value,t.name)})));break;case"application/json":t.postData.jsonObj&&(l.push(3,'JObject json = JObject.Parse(@"'+(0,code_helpers_1.addIndentation)((0,stringify_object_1.default)(t.postData.jsonObj,{indent:u.indent,inlineCharacterLimit:25}).replace(/"/g,'""'),{level:3,firstLine:!1})+'");'),l.push(3,'var postData = new StringContent(json.ToString(), Encoding.UTF8, "application/json");'));break;case"application/xml":t.postData.text&&(t.postData.text.trim().split("\n").forEach((function(t,e){var s=(0===e?'string xml = @"':"")+t.replace(/"/g,'""');l.push(0===e?3:4,s)})),l.push(3,'";'),l.push(3,'var postData = new StringContent(xml, Encoding.UTF8, "application/xml");'))}else w()&&(l.push(3,"var ms = new MemoryStream();"),l.push(3,"var postData = new StreamContent(ms);"),l.push(3,'postData.Headers.ContentType = new MediaTypeHeaderValue("application/octet-stream");'));return(0,code_helpers_1.printUrlVariablesDeclarations)(t,l,3),l.push(3,"var %s = await client.%sAsync(%s%s);",l.var("request"),c,(0,code_helpers_1.buildUrlExpression)(t,l),u.withImports?isDataMethod(t.method)?"application/x-www-form-urlencoded"===(0,utils_1.normalizeMimeType)(t.postData&&t.postData.mimeType)?", new FormUrlEncodedContent(postData)":"delete"===t.method?"":t.postData&&t.postData.params||w()?", postData":", null":"":", new FormUrlEncodedContent(postData)"),u.withWrapper&&(l.push(3,"var response = await request.Content.ReadAsStringAsync();"),l.blank(),l.push(3,"Console.WriteLine(response);"),l.push(2,"}"),l.push(1,"}"),l.push("}")),l.join();function f(e){return t.postData&&(0,utils_1.normalizeMimeType)(t.postData.mimeType)===e}function w(){return t.headersObj&&"application/octet-stream"===t.headersObj["Content-Type"]}};function addComments(t){t.push("/*"),t.push(" * Requires >= .NET 5"),t.push(" *"),t.push(' * Requires package "Newtonsoft.Json" >= 9.01'),t.push(" * See here for installation details:"),t.push(" *  https://www.newtonsoft.com/json"),t.push(" */"),t.blank()}function formatHttpMethod(t){return(0,generator_1.capitalizeFirst)(t.toLowerCase())}function isDataMethod(t){return t&&["POST","PUT","DELETE","PATCH"].includes(t.toUpperCase())}exports.info={key:"httpclient",title:"HttpClient",link:"https://docs.microsoft.com/en-us/dotnet/api/system.net.http.httpclient",description:".NET Standard HTTP Client"},exports.default=handler;
//# sourceMappingURL=httpclient.js.map