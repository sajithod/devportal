"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.info=void 0;var tslib_1=require("tslib"),code_builder_1=require("../../helpers/code-builder"),__1=require("../.."),constants_1=require("../../helpers/constants"),code_helpers_1=require("../../helpers/code-helpers"),utils_1=require("../../../../utils"),indent=1,contentType={X_FORM_URLENCODED:"application/x-www-form-urlencoded",JSON:"application/json",FORM_DATA:"multipart/form-data"};function hasMimeType(e,t){return void 0===e&&(e={}),(0,utils_1.normalizeMimeType)(e.mimeType)===t}var handler=function(e,t,n){var s,r,a,i,o,p,d=n.target,l=n.client,u=(0,tslib_1.__assign)({capitalize:!0,showBoilerplate:!0,checkErrors:!1,printBody:!0,timeout:-1,indent:"  "},t),h=null===(s=e.securityOAuth2ExtraCalls)||void 0===s?void 0:s[0],c=u.checkErrors?"err":"_",v=e.method.toUpperCase(),y=new code_builder_1.CodeBuilder({indentation:u.indent,variablesPrefix:u.variablesPrefix,capitalize:u.capitalize,lang:constants_1.Lang.GO}),m=function(){u.checkErrors&&y.push(indent,"if err != nil {").push(indent+1,"panic(err)").push(indent,"}")};if(u.showBoilerplate&&(y.push("package main").blank().push("import (").push(indent,'"fmt"'),u.timeout>0&&y.push(indent,'"time"'),h&&y.push(indent,'"encoding/json"'),hasMimeType(e.postData,contentType.FORM_DATA)&&(y.push(indent,'"mime/multipart"'),y.push(indent,'"io"'),y.push(indent,'"bytes"')),(hasMimeType(e.postData,contentType.X_FORM_URLENCODED)||hasMimeType(null===(a=null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0])||void 0===a?void 0:a.postData,contentType.X_FORM_URLENCODED))&&(y.push(indent,'"net/url"'),y.push(indent,'"strconv"')),(hasMimeType(e.postData,contentType.JSON)||hasMimeType(null===(o=null===(i=e.securityOAuth2ExtraCalls)||void 0===i?void 0:i[0])||void 0===o?void 0:o.postData,contentType.JSON))&&y.push(indent,'"bytes"'),(e.postData&&!hasMimeType(e.postData,contentType.JSON)||h)&&y.push(indent,'"strings"'),y.push(indent,'"net/http"'),u.printBody&&y.push(indent,'"io/ioutil"'),y.push(")").blank().push("func main() {")),Object.keys(e.allHeaders).length&&Object.keys(e.allHeaders).forEach((function(t){e.allHeaders[t]='"'+e.allHeaders[t]+'"'})),h){var _="oAuth2",b=u.checkErrors?c+" := ":"",f=u.capitalize?"Res":"res",q=new __1.HTTPSnippet(h).convert(d,l,(0,tslib_1.__assign)((0,tslib_1.__assign)({},u),{printBody:!1,variablesPrefix:_,showBoilerplate:!1}));y.push(q).blank().push(indent,"var oAuth2"+f+"Body struct {").push(indent+1,"Access_token string").push(indent,"}").push(indent,b+"json.NewDecoder("+_+f+".Body).Decode(&"+_+f+"Body)").blank(),m(),e.allHeaders.Authorization='"Bearer " + oAuth2'+f+"Body.Access_token"}if((0,code_helpers_1.printUrlVariablesDeclarations)(e,y,indent),u.timeout>0&&(l=y.var("client"),y.push(indent,"%s := http.Client{",l).push(indent+1,"Timeout: time.Duration(%s * time.Second),",u.timeout).push(indent,"}").blank()),y.push(indent,y.var("reqUrl")+" := "+(0,code_helpers_1.buildUrlExpression)(e,y)),e.postData){var w=void 0;switch((0,utils_1.normalizeMimeType)(e.postData.mimeType)){case contentType.X_FORM_URLENCODED:y.push(indent,"%s := url.Values{}",y.var("data")),e.postData.params.forEach((function(e){y.push(indent,'%s.Set("%s", "%s")',y.var("data"),e.name,e.value)})),y.push(indent,'%s, %s := http.NewRequest("%s", %s, strings.NewReader(%s.Encode()))',y.var("req"),c,v,y.var("reqUrl"),y.var("data")),e.allHeaders["Content-Length"]="strconv.Itoa(len("+y.var("data")+".Encode()))";break;case contentType.JSON:w=JSON.stringify(e.postData.jsonObj,null,2).split("\n").map((function(e){return u.indent+e})).join("\n").trim(),y.push(indent,"var "+y.var("data")+" = []byte(`"+w+"`)"),y.push(indent,'%s, %s := http.NewRequest("%s", %s, bytes.NewBuffer(%s))',y.var("req"),c,v,y.var("reqUrl"),y.var("data"));break;case contentType.FORM_DATA:y.push(indent,"%s := &bytes.Buffer{}",y.var("data")).push(indent,"writer := multipart.NewWriter(%s)",y.var("data")),e.postData.params.forEach((function(e){if(!e.fileName&&!e.contentType)return y.push(indent,'%s, _ := writer.CreateFormField("%s")',y.var(e.name+"Fw"),e.name).push(indent,'_, %s = io.Copy(%s, strings.NewReader("%s"))',c,y.var(e.name+"Fw"),e.value),void m();e.fileName&&(y.push(indent,'%s, %s = writer.CreateFormFile("%s", "%s")',y.var(e.name+"Fw"),c,e.name,e.fileName),m())})),y.push(indent,"writer.Close()").blank().push(indent,"%s := bytes.NewReader(%s.Bytes())",y.var("payload"),y.var("data")).push(indent,'%s, %s := http.NewRequest("%s", %s, %s)',y.var("req"),c,v,y.var("reqUrl"),y.var("payload")),e.allHeaders["Content-Type"]="writer.FormDataContentType()";break;default:e.postData.text&&y.push(indent,"%s := strings.NewReader(%s)",y.var("payload"),JSON.stringify(null===(p=e.postData)||void 0===p?void 0:p.text)).push(indent,'%s, %s := http.NewRequest("%s", %s, %s)',y.var("req"),c,v,y.var("reqUrl"),y.var("payload"))}}else y.push(indent,'%s, %s := http.NewRequest("%s", %s, nil)',y.var("req"),c,v,y.var("reqUrl"));if(Object.getOwnPropertyNames(e.queryObj).length){for(var O in y.blank().push(indent,y.var("query")+" := "+y.var("req")+".URL.Query()"),e.queryObj)y.push(indent,y.var("query")+'.Add("'+O+'", "'+e.queryObj[O]+'")');y.push(indent,y.var("req")+".URL.RawQuery = "+y.var("query")+".Encode()").blank()}if(m(),e.basicAuth){var T=e.basicAuth,D=T.username,N=T.password;y.push(indent,'%s.SetBasicAuth("'+D+'", "'+N+'")',y.var("req"))}return Object.keys(e.allHeaders).length&&Object.keys(e.allHeaders).forEach((function(t){y.push(indent,'%s.Header.Add("%s", %s)',y.var("req"),t,e.allHeaders[t])})),y.push(indent,"%s, %s := %s.Do(%s)",y.var("res"),c,l,y.var("req")),m(),u.printBody&&(y.push(indent,"defer %s.Body.Close()",y.var("res")).push(indent,"%s, %s := ioutil.ReadAll(%s.Body)",y.var("body"),c,y.var("res")),m()),y.blank().push(indent,"fmt.Println(%s)",y.var("res")),u.printBody&&y.push(indent,"fmt.Println(string(%s))",y.var("body")),u.showBoilerplate&&y.push("}"),y.join()};exports.info={key:"native",title:"NewRequest",link:"http://golang.org/pkg/net/http/#NewRequest",description:"Golang HTTP client request"},exports.default=handler;
//# sourceMappingURL=native.js.map