"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isHostAllowed=exports.cryptoLib=void 0;var tslib_1=require("tslib");function promisifyIECryptoRes(e){return"then"in e?e:new Promise((function(t){e.oncomplete=function(e){t(e.target.result)}}))}function str2ab(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0,o=e.length;n<o;n++)r[n]=e.charCodeAt(n);return t}exports.cryptoLib="undefined"!=typeof window&&(window.crypto||window.msCrypto)||void 0;var getKey=function(){var e=str2ab(atob("undefined"!=typeof REDOCLY_PUBLIC_KEY?REDOCLY_PUBLIC_KEY:"MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAMHjNir5fXx/ZXoaEeXQ5XyxbNJ4YJYczoCRdSkL6NLzw1FHnng5Vfcgk5+bvox9QRYRbuk84mA4f2NhywDbXKECAwEAAQ=="));return promisifyIECryptoRes(exports.cryptoLib.subtle.importKey("spki",e,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},!0,["verify"]))};function textEncode(e){if(window.TextEncoder)return(new TextEncoder).encode(e);for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}function verify(e,t){return(0,tslib_1.__awaiter)(this,void 0,void 0,(function(){var r,n,o,i;return(0,tslib_1.__generator)(this,(function(s){switch(s.label){case 0:return r=promisifyIECryptoRes,o=(n=exports.cryptoLib.subtle).verify,i=[{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"}],[4,getKey()];case 1:return[2,r.apply(void 0,[o.apply(n,i.concat([s.sent(),str2ab(atob(t)),textEncode(e)]))])]}}))}))}function isHostAllowed(e,t){return!0===t||!(!Array.isArray(t)||"undefined"==typeof window)&&(!("localhost"!==e&&"127.0.0.1"!==e&&!e.endsWith(".localhost")&&!t.find((function(t){return t===e||e.endsWith("."+t)})))||!!t.find((function(t){if(t.indexOf("*")===t.lastIndexOf("*")){var r=t.split("*"),n=r[0],o=r[1];return o&&e.startsWith(n)&&e.endsWith(o)&&o.split(".").length>2}})))}function parse(e){return(0,tslib_1.__awaiter)(this,void 0,void 0,(function(){var t,r,n,o,i;return(0,tslib_1.__generator)(this,(function(s){switch(s.label){case 0:if("development"===process.env.NODE_ENV)return[2,{valid:!0,allowed:!0}];if(t=window.location.hostname,!e)return"localhost"===t||"127.0.0.1"===t||t.endsWith(".localhost")?[2,{local:!0}]:[2,{}];r=e.split("."),n=r[0],o=r[1],s.label=1;case 1:return s.trys.push([1,3,,4]),[4,verify(atob(n),o)];case 2:return s.sent()?(i=JSON.parse(atob(n)),[3,4]):[2,{valid:!1}];case 3:return s.sent(),[2,{valid:!1,cryptoMissing:!0}];case 4:return i.valid=!0,(!i.e||Date.now()/1e3>i.e)&&(i.expired=!0),i.allowed=isHostAllowed(t,i.h),[2,i]}}))}))}exports.isHostAllowed=isHostAllowed,exports.default=parse;
//# sourceMappingURL=check.js.map