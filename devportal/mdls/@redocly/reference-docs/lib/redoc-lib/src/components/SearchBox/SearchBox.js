"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SearchBox=void 0;var tslib_1=require("tslib"),React=(0,tslib_1.__importStar)(require("react")),MenuItem_1=require("../SideMenu/MenuItem"),decko_1=require("decko"),perfect_scrollbar_1=require("../../common-elements/perfect-scrollbar"),styled_elements_1=require("./styled.elements"),SearchBox=function(e){function t(t){var r=e.call(this,t)||this;return Object.defineProperty(r,"activeItemRef",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(r,"clear",{enumerable:!0,configurable:!0,writable:!0,value:function(){r.setState({results:[],term:"",activeItemIdx:-1}),r.props.marker.unmark()}}),Object.defineProperty(r,"handleKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:function(e){if(27===e.keyCode&&r.clear(),40===e.keyCode&&(r.setState({activeItemIdx:Math.min(r.state.activeItemIdx+1,r.state.results.length-1)}),e.preventDefault()),38===e.keyCode&&(r.setState({activeItemIdx:Math.max(0,r.state.activeItemIdx-1)}),e.preventDefault()),13===e.keyCode){var t=r.state.results[r.state.activeItemIdx];if(t){var a=r.props.getItemById(t.meta);a&&r.props.onActivate(a)}}}}),Object.defineProperty(r,"search",{enumerable:!0,configurable:!0,writable:!0,value:function(e){var t=e.target.value;t.length<3?r.clearResults(t):r.setState({term:t},(function(){return r.searchCallback(r.state.term)}))}}),r.state={results:[],term:"",activeItemIdx:-1},r}return(0,tslib_1.__extends)(t,e),Object.defineProperty(t.prototype,"clearResults",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.setState({results:[],term:e}),this.props.marker.unmark()}}),Object.defineProperty(t.prototype,"setResults",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){this.setState({results:e}),this.props.marker.mark(t)}}),Object.defineProperty(t.prototype,"searchCallback",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this;this.props.search.search(e).then((function(r){t.setResults(r,e)}))}}),Object.defineProperty(t.prototype,"render",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,t=this.state.activeItemIdx,r=this.state.results.map((function(t){return{item:e.props.getItemById(t.meta),score:t.score}}));return r.sort((function(e,t){return t.score-e.score})),React.createElement(styled_elements_1.SearchWrap,{role:"search"},this.state.term&&React.createElement(styled_elements_1.ClearIcon,{onClick:this.clear},"Ã—"),React.createElement(styled_elements_1.SearchIcon,null),React.createElement(styled_elements_1.SearchInput,{value:this.state.term,onKeyDown:this.handleKeyDown,placeholder:"Search...","aria-label":"Search",type:"text",onChange:this.search}),r.length>0&&React.createElement(perfect_scrollbar_1.PerfectScrollbarWrap,{options:{wheelPropagation:!1}},React.createElement(styled_elements_1.SearchResultsBox,{"data-role":"search:results"},r.map((function(r,a){var l=r.item;return React.createElement(MenuItem_1.MenuItem,{item:Object.create(l||{},{active:{value:a===t}}),onActivate:e.props.onActivate,withoutChildren:!0,key:null==l?void 0:l.id,"data-role":"search:result"})})))))}}),(0,tslib_1.__decorate)([decko_1.bind,(0,decko_1.debounce)(400)],t.prototype,"searchCallback",null),t}(React.PureComponent);exports.SearchBox=SearchBox;
//# sourceMappingURL=SearchBox.js.map