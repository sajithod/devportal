"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MenuBuilder=exports.GROUP_DEPTH=void 0;var tslib_1=require("tslib"),utils_1=require("../utils"),MarkdownRenderer_1=require("./MarkdownRenderer"),models_1=require("./models");exports.GROUP_DEPTH=0;var MenuBuilder=function(){function e(){}return Object.defineProperty(e,"buildStructure",{enumerable:!1,configurable:!0,writable:!0,value:function(r,t){var a=r.definition,n=[],i=e.getTagsWithOperations(r);return n.push.apply(n,e.addMarkdownItems(a.info.description||"",void 0,1,t)),a["x-tagGroups"]&&a["x-tagGroups"].length>0?n.push.apply(n,e.getTagGroupsItems(r,void 0,a["x-tagGroups"],i,t)):n.push.apply(n,e.getTagsItems(r,i,void 0,void 0,t)),n}}),Object.defineProperty(e,"addMarkdownItems",{enumerable:!1,configurable:!0,writable:!0,value:function(e,r,t,a){var n=new MarkdownRenderer_1.MarkdownRenderer(a).extractHeadings(e||"");n.length&&r&&r.description&&(r.description=MarkdownRenderer_1.MarkdownRenderer.getTextBeforeHading(r.description,n[0].name));var i=function(e,r,t){return void 0===t&&(t=1),r.map((function(r){var a=new models_1.GroupModel("section",r,e);return a.depth=t,r.items&&(a.items=i(a,r.items,t+1)),MarkdownRenderer_1.MarkdownRenderer.containsComponent(a.description||"",utils_1.SECURITY_DEFINITIONS_COMPONENT_NAME)&&(0,utils_1.setSecuritySchemePrefix)(a.id+"/"),a}))};return i(r,n,t)}}),Object.defineProperty(e,"getTagGroupsItems",{enumerable:!1,configurable:!0,writable:!0,value:function(r,t,a,n,i){for(var o=[],s=0,l=a;s<l.length;s++){var d=l[s],p=new models_1.GroupModel("group",d,t);p.depth=exports.GROUP_DEPTH,p.items=e.getTagsItems(r,n,p,d,i),o.push(p)}return o}}),Object.defineProperty(e,"getTagsItems",{enumerable:!1,configurable:!0,writable:!0,value:function(r,t,a,n,i){for(var o=[],s=0,l=(void 0===n?Object.keys(t):n.tags).map((function(e){return t[e]?(t[e].used=!0,t[e]):(console.warn('Non-existing tag "'+e+'" is added to the group "'+(null==n?void 0:n.name)+'"'),null)}));s<l.length;s++){var d=l[s];if(d){var p=new models_1.GroupModel("tag",d,a);if(p.depth=exports.GROUP_DEPTH+1,""!==d.name)p.items=(0,tslib_1.__spreadArray)((0,tslib_1.__spreadArray)([],e.addMarkdownItems(d.description||"",p,p.depth+1,i),!0),this.getOperationsItems(r,p,d,p.depth+1,i),!0),o.push(p);else{var u=(0,tslib_1.__spreadArray)((0,tslib_1.__spreadArray)([],e.addMarkdownItems(d.description||"",p,p.depth+1,i),!0),this.getOperationsItems(r,void 0,d,p.depth+1,i),!0);o.push.apply(o,u)}}}return i.sortTagsAlphabetically&&o.sort((0,utils_1.alphabeticallyByProp)("name")),o}}),Object.defineProperty(e,"getOperationsItems",{enumerable:!1,configurable:!0,writable:!0,value:function(e,r,t,a,n){if(0===t.operations.length)return[];for(var i=[],o=0,s=t.operations;o<s.length;o++){var l=s[o],d=new models_1.OperationModel(e,l,r,n);d.depth=a,i.push(d)}return n.sortOperationsAlphabetically&&i.sort((0,utils_1.alphabeticallyByProp)("name")),i}}),Object.defineProperty(e,"getTagsWithOperations",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var r={},t=e.definition,a=t["x-webhooks"]||t.webhooks,n=0,i=t.tags||[];n<i.length;n++){var o=i[n];r[o.name]=(0,tslib_1.__assign)((0,tslib_1.__assign)({},o),{operations:[]})}function s(e,t,a){for(var n,i=0,o=Object.keys(t||{});i<o.length;i++)for(var l=o[i],d=t[l],p=0,u=Object.keys(d).filter(utils_1.isOperationName);p<u.length;p++){var g=u[p],_=d[g];if(d.$ref){var c=e.deref(d);s(e,((n={})[l]=c,n),a)}else{var b=null==_?void 0:_.tags;b&&b.length||(b=[""]);for(var h=0,m=b;h<m.length;h++){var f=m[h],v=r[f];void 0===v&&(v={name:f,operations:[]},r[f]=v),v["x-traitTag"]||v.operations.push((0,tslib_1.__assign)((0,tslib_1.__assign)({},_),{pathName:l,pointer:utils_1.JsonPointer.compile(["paths",l,g]),httpVerb:g,pathParameters:d.parameters||[],pathServers:d.servers,isWebhook:!!a}))}}}}return t.paths&&s(e,t.paths),a&&s(e,a,!0),r}}),e}();exports.MenuBuilder=MenuBuilder;
//# sourceMappingURL=MenuBuilder.js.map