"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MarkdownRenderer=exports.buildComponentComment=exports.COMPONENT_REGEXP=exports.MDX_COMPONENT_REGEXP=exports.LEGACY_REGEXP=void 0;var tslib_1=require("tslib"),marked_1=require("marked"),utils_1=require("../utils"),renderer=new marked_1.marked.Renderer;function buildComponentComment(e){return"\x3c!-- ReDoc-Inject: <"+e+"> --\x3e"}marked_1.marked.setOptions({renderer:renderer,highlight:function(e,r){return(0,utils_1.highlight)(e,r)}}),exports.LEGACY_REGEXP="^ {0,3}\x3c!-- ReDoc-Inject:\\s+?<({component}).*?/?>\\s+?--\x3e\\s*$",exports.MDX_COMPONENT_REGEXP="(?:^ {0,3}<({component})([\\s\\S]*?)>([\\s\\S]*?)</\\2>|^ {0,3}<({component})([\\s\\S]*?)(?:/>|\\n{2,}))",exports.COMPONENT_REGEXP="(?:"+exports.LEGACY_REGEXP+"|"+exports.MDX_COMPONENT_REGEXP+")",exports.buildComponentComment=buildComponentComment;var MarkdownRenderer=function(){function e(e){var r=this;Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"headings",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"currentTopHeading",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headingEnhanceRenderer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"originalHeadingRule",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headingRule",{enumerable:!0,configurable:!0,writable:!0,value:function(e,n,t,i){var a,o;return 1===n?r.currentTopHeading=r.saveHeading(e,n):2===n&&r.saveHeading(e,n,null===(a=r.currentTopHeading)||void 0===a?void 0:a.items,null===(o=r.currentTopHeading)||void 0===o?void 0:o.id),r.originalHeadingRule(e,n,t,i)}}),this.headingEnhanceRenderer=new marked_1.marked.Renderer,this.parser=new marked_1.marked.Parser,this.originalHeadingRule=this.headingEnhanceRenderer.heading.bind(this.headingEnhanceRenderer),this.headingEnhanceRenderer.heading=this.headingRule}return Object.defineProperty(e,"containsComponent",{enumerable:!1,configurable:!0,writable:!0,value:function(e,r){return new RegExp(exports.COMPONENT_REGEXP.replace(/{component}/g,r),"gmi").test(e)}}),Object.defineProperty(e,"getTextBeforeHading",{enumerable:!1,configurable:!0,writable:!0,value:function(e,r){var n=e.search(new RegExp("^(>\\s+##|##)?\\s+"+r,"m"));return n>-1?e.substring(0,n):e}}),Object.defineProperty(e.prototype,"saveHeading",{enumerable:!1,configurable:!0,writable:!0,value:function(e,r,n,t){void 0===n&&(n=this.headings),e=(0,utils_1.unescapeHTMLChars)(e);var i={id:t?t+"/"+(0,utils_1.safeSlugify)(e):"section/"+(0,utils_1.safeSlugify)(e),name:e,level:r,items:[]};return n.push(i),i}}),Object.defineProperty(e.prototype,"flattenHeadings",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(void 0===e)return[];for(var r=[],n=0,t=e;n<t.length;n++){var i=t[n];r.push(i),r.push.apply(r,this.flattenHeadings(i.items))}return r}}),Object.defineProperty(e.prototype,"attachHeadingsDescriptions",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var r=function(e){return new RegExp("##?\\s+"+e.name.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"))},n=this.flattenHeadings(this.headings);if(!(n.length<1)){for(var t=n[0],i=r(t),a=e.search(i),o=1;o<n.length;o++){var s=n[o],u=r(s),d=e.substr(a+1).search(u)+a+1;t.description=e.substring(a,d).replace(i,"").trim(),t=s,i=u,a=d}t.description=e.substring(a).replace(i,"").trim()}}}),Object.defineProperty(e.prototype,"renderMd",{enumerable:!1,configurable:!0,writable:!0,value:function(e,r){void 0===r&&(r=!1);var n=r?{renderer:this.headingEnhanceRenderer}:void 0;return(0,marked_1.marked)(e.toString(),n)}}),Object.defineProperty(e.prototype,"extractHeadings",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.renderMd(e,!0),this.attachHeadingsDescriptions(e);var r=this.headings;return this.headings=[],r}}),Object.defineProperty(e.prototype,"renderMdWithComponents",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var r=this.options&&this.options.allowedMdComponents;if(!r||0===Object.keys(r).length)return[this.renderMd(e)];for(var n=Object.keys(r).join("|"),t=new RegExp(exports.COMPONENT_REGEXP.replace(/{component}/g,n),"mig"),i=[],a=[],o=t.exec(e),s=0;o;){i.push(e.substring(s,o.index)),s=t.lastIndex;var u=r[o[1]||o[2]||o[5]],d=o[3]||o[6],l=o[4];u&&a.push({component:u.component,propsSelector:u.propsSelector,props:(0,tslib_1.__assign)((0,tslib_1.__assign)((0,tslib_1.__assign)({},parseProps(d)),u.props),{children:l})}),o=t.exec(e)}i.push(e.substring(s));for(var p=[],c=0;c<i.length;c++){var g=i[c];g&&p.push(this.renderMd(g)),a[c]&&p.push(a[c])}return p}}),e}();function parseProps(e){if(!e)return{};for(var r,n=/([\w-]+)\s*=\s*(?:{([^}]+?)}|"([^"]+?)")/gim,t={};null!==(r=n.exec(e));)if(r[3])t[r[1]]=r[3];else if(r[2]){var i=void 0;try{i=JSON.parse(r[2])}catch(e){}t[r[1]]=i}return t}exports.MarkdownRenderer=MarkdownRenderer;
//# sourceMappingURL=MarkdownRenderer.js.map