"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),CodeMirror=(0,tslib_1.__importStar)(require("codemirror")),vscode_json_languageservice_1=require("@redocly/vscode-json-languageservice"),vscode_json_languageservice_2=require("@redocly/vscode-json-languageservice");require("codemirror/mode/javascript/javascript"),require("codemirror/addon/edit/matchbrackets"),require("codemirror/addon/lint/lint"),require("codemirror/addon/hint/show-hint"),require("codemirror/addon/edit/closebrackets"),require("codemirror/addon/search/searchcursor"),require("codemirror/lib/codemirror.css"),require("codemirror/theme/material.css"),require("codemirror/addon/lint/lint.css"),require("codemirror/addon/hint/show-hint.css");var serv=(0,vscode_json_languageservice_2.getLanguageService)({});CodeMirror.registerHelper("lint","json",(function(e,r){return(0,tslib_1.__awaiter)(this,void 0,void 0,(function(){var t,i,o,n,s;return(0,tslib_1.__generator)(this,(function(a){switch(a.label){case 0:return t=r.schema,i=r.setError,serv.configure({validate:!0,schemas:[{uri:"stub://"+r.id,fileMatch:["*"],schema:t}]}),o=vscode_json_languageservice_1.TextDocument.create(r.id+".json","json",0,e),n=serv.parseJSONDocument(o),[4,serv.doValidation(o,n)];case 1:return(s=a.sent()).length?i&&i(s[0].message):i&&i(void 0),[2,s.map((function(e){return{from:CodeMirror.Pos(e.range.start.line,e.range.start.character),to:CodeMirror.Pos(e.range.end.line,e.range.end.character),message:e.message}}))]}}))}))})),CodeMirror.registerHelper("hint","json",(function(e,r){return(0,tslib_1.__awaiter)(void 0,void 0,void 0,(function(){var t,i,o,n,s,a,c,d;return(0,tslib_1.__generator)(this,(function(l){switch(l.label){case 0:return(t=r.schema)?(serv.configure({validate:!0,schemas:[{uri:"stub://"+r.id,fileMatch:["*"],schema:t}]}),i=e.getDoc().getCursor(),o=e.getTokenAt(i),n=vscode_json_languageservice_1.TextDocument.create(r.id+".json","json",0,e.getValue()),s=serv.parseJSONDocument(n),[4,serv.doComplete(n,{line:i.line,character:i.ch},s)]):[2];case 1:return a=l.sent(),c=function(e){for(var r="";e--;)r+=" ";return r},d=a?a.items.map((function(e){return{text:e.insertText,displayText:e.label,filter:e.filterText||e.label,from:{line:e.textEdit.range.start.line,ch:e.textEdit.range.start.character},to:{line:e.textEdit.range.end.line,ch:e.textEdit.range.end.character},hint:function(e,r,t){var i="_$__REDOC_CURSOR_HERE",o=t.text.replace(/(\$1|\${1:[^}]+})/,i)||"";if(o=o.replace(/(\$\d+|\${[^}]+})/g,"")||"",e.setSelection(t.from,t.to),o.indexOf("\n")>-1){var n=e.getLine(e.getCursor().line).search(/(\S|$)/);o=o.replace(/\n/g,"\n"+c(n))}e.replaceSelection(o);var s=e.getSearchCursor(i,t.from);s.findNext()&&(e.setCursor(s.from()),s.replace(""))}}})):[],/(property|string)/.test(o.type||"")&&(d=d.filter((function(e){return e.filter.replace(/(^"|"$)/g,"").startsWith(o.string.replace(/(^"|"$)/g,""))}))),[2,{from:CodeMirror.Pos(i.line,o.start),to:CodeMirror.Pos(i.line,i.ch),list:d}]}}))}))}));
//# sourceMappingURL=codemirror-helpers.js.map