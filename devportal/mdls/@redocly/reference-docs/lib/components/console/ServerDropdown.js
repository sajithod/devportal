"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ServerChooser=void 0;var tslib_1=require("tslib"),React=(0,tslib_1.__importStar)(require("react")),redoc_lib_1=require("../../redoc-lib"),mobx_react_1=require("mobx-react"),utils_1=require("../../utils"),ServerVariable_1=(0,tslib_1.__importDefault)(require("./ServerVariable")),form_1=require("../common/form"),utils_2=require("./utils"),ServerChooser=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(r,"state",{enumerable:!0,configurable:!0,writable:!0,value:{activeIdx:0,variables:{}}}),Object.defineProperty(r,"handleServerChange",{enumerable:!0,configurable:!0,writable:!0,value:function(e){var t=r.props.operation.servers.find((function(r){return r.url===e.serverUrl})),a=(0,utils_2.getDefaultOrStoredVariables)(t);r.props.onChange({url:e.serverUrl,variables:a}),(0,utils_1.toSessionStorage)("serverUrl",e.serverUrl),r.setState({variables:a})}}),Object.defineProperty(r,"handleVariableChange",{enumerable:!0,configurable:!0,writable:!0,value:function(e,t){var a,i=r.props.operation.servers[r.state.activeIdx],l=(0,tslib_1.__assign)((0,tslib_1.__assign)({},r.state.variables),((a={})[e]=t||(0,utils_2.getDefaultOrStoredVariables)(i)[e],a));r.setState({variables:l}),(0,utils_2.updateVariablesStorage)(e,t),r.props.onChange((0,tslib_1.__assign)((0,tslib_1.__assign)({},i),{variables:l}))}}),r}return(0,tslib_1.__extends)(r,e),Object.defineProperty(r,"getDerivedStateFromProps",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var r=e.operation,t=(0,utils_1.fromSessionStorage)("serverUrl"),a=r.servers.findIndex((function(e){return e.url===t}));return{activeIdx:a<0?0:a}}}),Object.defineProperty(r.prototype,"componentDidMount",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=(0,utils_2.getServerWithVariables)(this.props.operation.servers,this.state.activeIdx);this.props.onChange(e),this.setState({variables:e.variables})}}),Object.defineProperty(r.prototype,"render",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,r=this.state.activeIdx,t=this.props.operation.servers.map((function(r){return{serverUrl:r.url,value:"\n          "+(0,utils_2.expandDefaultServerVariables)((0,utils_2.expandVariables)(r.url,e.state.variables),r.variables)+"\n        - "+(r.description||"Default")+"\n      "}})),a=Object.keys(this.state.variables);return React.createElement(ServerDropdownWrap,null,React.createElement(form_1.FormLabel,{htmlFor:"server"},"Target server: "),React.createElement(form_1.FormControl,null,React.createElement(redoc_lib_1.Dropdown,{openUp:!0,variant:"dark",value:t[r].value,options:t,onChange:this.handleServerChange})),a.length?a.map((function(r){var t,a=null===(t=e.props.operation.servers[e.state.activeIdx].variables)||void 0===t?void 0:t[r];if(a)return React.createElement(ServerVariable_1.default,{key:r,name:r,value:e.state.variables[r],defaultValue:a.default,onChange:function(t){return e.handleVariableChange(r,t)},variableEnum:a.enum,description:a.description})})):null)}}),r=(0,tslib_1.__decorate)([mobx_react_1.observer],r)}(React.Component);exports.ServerChooser=ServerChooser;var templateObject_1,ServerDropdownWrap=redoc_lib_1.styled.div(templateObject_1||(templateObject_1=(0,tslib_1.__makeTemplateObject)(["\n  margin-top: 20px;\n"],["\n  margin-top: 20px;\n"])));
//# sourceMappingURL=ServerDropdown.js.map