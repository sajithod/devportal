import{__awaiter,__generator}from"tslib";import*as CodeMirror from"codemirror";import{TextDocument}from"@redocly/vscode-json-languageservice";import{getLanguageService}from"@redocly/vscode-json-languageservice";import"codemirror/mode/javascript/javascript";import"codemirror/addon/edit/matchbrackets";import"codemirror/addon/lint/lint";import"codemirror/addon/hint/show-hint";import"codemirror/addon/edit/closebrackets";import"codemirror/addon/search/searchcursor";import"codemirror/lib/codemirror.css";import"codemirror/theme/material.css";import"codemirror/addon/lint/lint.css";import"codemirror/addon/hint/show-hint.css";var serv=getLanguageService({});CodeMirror.registerHelper("lint","json",(function(r,e){return __awaiter(this,void 0,void 0,(function(){var t,o,i,n,a;return __generator(this,(function(s){switch(s.label){case 0:return t=e.schema,o=e.setError,serv.configure({validate:!0,schemas:[{uri:"stub://"+e.id,fileMatch:["*"],schema:t}]}),i=TextDocument.create(e.id+".json","json",0,r),n=serv.parseJSONDocument(i),[4,serv.doValidation(i,n)];case 1:return(a=s.sent()).length?o&&o(a[0].message):o&&o(void 0),[2,a.map((function(r){return{from:CodeMirror.Pos(r.range.start.line,r.range.start.character),to:CodeMirror.Pos(r.range.end.line,r.range.end.character),message:r.message}}))]}}))}))})),CodeMirror.registerHelper("hint","json",(function(r,e){return __awaiter(void 0,void 0,void 0,(function(){var t,o,i,n,a,s,c,d;return __generator(this,(function(m){switch(m.label){case 0:return(t=e.schema)?(serv.configure({validate:!0,schemas:[{uri:"stub://"+e.id,fileMatch:["*"],schema:t}]}),o=r.getDoc().getCursor(),i=r.getTokenAt(o),n=TextDocument.create(e.id+".json","json",0,r.getValue()),a=serv.parseJSONDocument(n),[4,serv.doComplete(n,{line:o.line,character:o.ch},a)]):[2];case 1:return s=m.sent(),c=function(r){for(var e="";r--;)e+=" ";return e},d=s?s.items.map((function(r){return{text:r.insertText,displayText:r.label,filter:r.filterText||r.label,from:{line:r.textEdit.range.start.line,ch:r.textEdit.range.start.character},to:{line:r.textEdit.range.end.line,ch:r.textEdit.range.end.character},hint:function(r,e,t){var o="_$__REDOC_CURSOR_HERE",i=t.text.replace(/(\$1|\${1:[^}]+})/,o)||"";if(i=i.replace(/(\$\d+|\${[^}]+})/g,"")||"",r.setSelection(t.from,t.to),i.indexOf("\n")>-1){var n=r.getLine(r.getCursor().line).search(/(\S|$)/);i=i.replace(/\n/g,"\n"+c(n))}r.replaceSelection(i);var a=r.getSearchCursor(o,t.from);a.findNext()&&(r.setCursor(a.from()),a.replace(""))}}})):[],/(property|string)/.test(i.type||"")&&(d=d.filter((function(r){return r.filter.replace(/(^"|"$)/g,"").startsWith(i.string.replace(/(^"|"$)/g,""))}))),[2,{from:CodeMirror.Pos(o.line,i.start),to:CodeMirror.Pos(o.line,o.ch),list:d}]}}))}))}));
//# sourceMappingURL=codemirror-helpers.js.map