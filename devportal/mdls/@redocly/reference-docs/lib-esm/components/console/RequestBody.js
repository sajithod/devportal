var _this=this;import{__assign,__awaiter,__generator,__rest}from"tslib";import*as React from"react";import{useEffect}from"react";import{observer}from"mobx-react";import merge from"deepmerge";import{DropdownOrLabel,Dropdown,MediaTypesSwitch}from"../../redoc-lib";import CodemirrorInput from"./CodemirrorInput";import{RequestMimeLabel}from"./RequestMimeLabel";import{ExampleSwitch,useExampleKey}from"../Samples";import{arrayMerge}from"../../services/utils";import{RequestBodyForm}from"./RequestBodyForm";import{isRootFileUpload}from"../common/FileUpload/helper";import{MediaTypes}from"../../models";export var RequestBody=observer((function(e){var r,o,t=e.properties,a=void 0===t?{}:t,i=__rest(e,["properties"]),n=function(e){var r,o=i.body.content;if(!o||!o.hasSample)return"";var t=null===(r=o.active)||void 0===r?void 0:r.examples;if(!(null==t?void 0:t[e]))return"";var n=merge(null==t?void 0:t[e].value,a,{arrayMerge:arrayMerge});return JSON.stringify(n,null,2)},l=null===(o=null===(r=i.body.content)||void 0===r?void 0:r.operation)||void 0===o?void 0:o.activeExampleName,m=function(e){var r,o;null===(o=null===(r=i.body.content)||void 0===r?void 0:r.operation)||void 0===o||o.activateExampleName(e),i.console.formApi.setValue("body",n(e))},d=function(e){if(!e)return"";if("application/x-www-form-urlencoded"===e.mime)return e.value;var r=merge(e.value,a,{arrayMerge:arrayMerge});return JSON.stringify(r,null,2)},u=function(e,r){return __awaiter(void 0,void 0,void 0,(function(){var o;return __generator(this,(function(t){return o=i.console.formApi,(0,o.setValue)("body."+e,r),[2]}))}))};useEffect((function(){!1!==l?l&&i.console.formApi.setValue("body",n(l)):i.console.formApi.setValue("body",JSON.stringify(a,null,2))}),[l]);var p=i.validate,s=i.body;return React.createElement(React.Fragment,null,React.createElement(MediaTypesSwitch,{content:s.content,renderDropdown:function(e){return React.createElement(DropdownOrLabel,__assign({},e,{variant:"dark",fullWidth:!0,Label:RequestMimeLabel,Dropdown:Dropdown}))}},(function(e){var r,o=e.examples||{},t=Object.keys(o),a=e.schema,n=isRootFileUpload(a||{},e.name)||e.name===MediaTypes.MULTIPART||e.name===MediaTypes.URL_ENCODED,l=useExampleKey(e.operation,o).exampleKey,s=o[l];return React.createElement(React.Fragment,null,t.length&&1!==t.length&&React.createElement(ExampleSwitch,{examples:o,onChange:m,exampleKey:l})||null,n?React.createElement(RequestBodyForm,{mediaType:e,onChange:u.bind(_this)}):React.createElement(CodemirrorInput,{id:"body"+i.id,field:"body",initialValue:d(s),schema:((null===(r=null==i?void 0:i.resolvedBody)||void 0===r?void 0:r.content[e.name])||{}).schema,mode:e.name,validate:p}))})))}));
//# sourceMappingURL=RequestBody.js.map