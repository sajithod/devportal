import{__awaiter,__extends,__generator}from"tslib";import{SearchStore}from"../redoc-lib";function removeMarkdown(e){return e.replace(/\[(.*?)][[(].*?[\])]/g,"$1")}export var DEFAULT_SEARCH_MAX_DEPTH=1;var DeepSearchStore=function(e){function t(t){var r=e.call(this)||this;return Object.defineProperty(r,"operationTitleBoost",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(r,"tagTitleBoost",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(r,"fieldLevelBoost",{enumerable:!0,configurable:!0,writable:!0,value:.95}),Object.defineProperty(r,"pathOnly",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(r,"searchMaxDepth",{enumerable:!0,configurable:!0,writable:!0,value:DEFAULT_SEARCH_MAX_DEPTH}),t.searchOperationTitleBoost&&(r.operationTitleBoost=parseInt(t.searchOperationTitleBoost,10)),t.searchTagTitleBoost&&(r.tagTitleBoost=parseInt(t.searchTagTitleBoost,10)),t.searchFieldLevelBoost&&(r.fieldLevelBoost=parseInt(t.searchFieldLevelBoost,10)),"path-only"===t.searchMode&&(r.pathOnly=!0),t.searchMaxDepth&&(r.searchMaxDepth=t.searchMaxDepth),r}return __extends(t,e),Object.defineProperty(t.prototype,"indexItems",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this,r=function(e){e.forEach((function(e){if("operation"===e.type&&t.pathOnly){var o=e;t.add(o.path,"",{menuId:o.id,boost:t.operationTitleBoost})}else{if("group"===e.type||t.pathOnly||(t.add(e.name,"operation"===e.type?e.path:"",{menuId:e.id,boost:"operation"===e.type?t.operationTitleBoost:t.tagTitleBoost}),e.description&&t.add("",removeMarkdown(e.description||""),{menuId:e.id})),"operation"===e.type){for(var a=0,n=(o=e).parameters||[];a<n.length;a++){var i=n[a];t.add(i.name,removeMarkdown(i.description),{menuId:e.id,place:"parameters",path:[i.name]})}var c=o.requestBody&&o.requestBody.content&&o.requestBody.content.active&&o.requestBody.content.active.schema;t.indexSchema(c,e.id,"request fields"),o.responses.forEach((function(r){var o=r.content&&r.content.active&&r.content.active.schema;o&&t.indexSchema(o,e.id,"response "+r.code+" fields")}))}r(e.items)}}))};r(e),this.searchWorker.done()}}),Object.defineProperty(t.prototype,"indexSchema",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r,o,a){if(void 0===o&&(o=[]),void 0===a&&(a=0),e&&!(a>this.searchMaxDepth||e.isCircular)){if((e=e.oneOf&&e.oneOf[e.activeOneOf]||e).fields)for(var n=0,i=e.fields;n<i.length;n++){var c=i[n],l=o.concat([c.name]);"additionalProperties"!==c.kind&&(this.add(c.name,removeMarkdown(c.description),{menuId:t,place:r,path:l,boost:Math.pow(this.fieldLevelBoost,a)}),this.indexSchema(c.schema,t,r,l,a+1))}e.items&&this.indexSchema(e.items,t,r,o,a+1)}}}),Object.defineProperty(t.prototype,"add",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){this.searchWorker.add(e,t,r)}}),Object.defineProperty(t.prototype,"search",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.searchWorker.search(e)];case 1:return[2,t.sent()]}}))}))}}),Object.defineProperty(t.prototype,"toJS",{enumerable:!1,configurable:!0,writable:!0,value:function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.searchWorker.toJS()]}))}))}}),Object.defineProperty(t.prototype,"dispose",{enumerable:!1,configurable:!0,writable:!0,value:function(){"terminate"in this.searchWorker&&this.searchWorker.terminate(),this.searchWorker.dispose&&this.searchWorker.dispose()}}),t}(SearchStore);export{DeepSearchStore};var RemoteSearch=function(e){function t(t){var r=e.call(this)||this;return Object.defineProperty(r,"url",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(r,"operationTitleBoost",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(r,"tagTitleBoost",{enumerable:!0,configurable:!0,writable:!0,value:8}),Object.defineProperty(r,"fieldLevelBoost",{enumerable:!0,configurable:!0,writable:!0,value:.95}),r}return __extends(t,e),Object.defineProperty(t.prototype,"indexItems",{enumerable:!1,configurable:!0,writable:!0,value:function(e){}}),Object.defineProperty(t.prototype,"add",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,r){throw new Error("Not implemented")}}),Object.defineProperty(t.prototype,"search",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return __awaiter(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(o){switch(o.label){case 0:t=[],o.label=1;case 1:return o.trys.push([1,4,,5]),[4,fetch(this.url+"?q="+encodeURIComponent(e))];case 2:return[4,o.sent().json()];case 3:if(t=o.sent(),!Array.isArray(t))throw t=[],new Error("wrong search results format");return[3,5];case 4:return r=o.sent(),console.error("Failed to load search results: "+r.message),[3,5];case 5:return[2,t]}}))}))}}),Object.defineProperty(t.prototype,"dispose",{enumerable:!1,configurable:!0,writable:!0,value:function(){e.prototype.dispose.call(this)}}),Object.defineProperty(t.prototype,"load",{enumerable:!1,configurable:!0,writable:!0,value:function(){}}),Object.defineProperty(t.prototype,"toJS",{enumerable:!1,configurable:!0,writable:!0,value:function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){throw new Error("Not implemented")}))}))}}),t}(SearchStore);export{RemoteSearch};
//# sourceMappingURL=SearchStore.js.map